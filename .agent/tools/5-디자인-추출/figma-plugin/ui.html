<!DOCTYPE html>
<html>

<head>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Inter, -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 16px;
      background: #2c2c2c;
      color: #fff;
      min-height: 100vh;
    }

    h2 {
      font-size: 14px;
      margin-bottom: 12px;
      color: #fff;
    }

    .section {
      margin-bottom: 16px;
    }

    .label {
      font-size: 11px;
      color: #999;
      margin-bottom: 6px;
    }

    .file-drop {
      border: 2px dashed #555;
      border-radius: 8px;
      padding: 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 12px;
    }

    .file-drop:hover,
    .file-drop.dragover {
      border-color: #0d99ff;
      background: rgba(13, 153, 255, 0.1);
    }

    .file-drop input {
      display: none;
    }

    .file-drop-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }

    .file-drop-text {
      font-size: 12px;
      color: #999;
    }

    .file-list {
      font-size: 11px;
      color: #999;
      margin-bottom: 12px;
    }

    .file-item {
      background: #383838;
      padding: 8px 12px;
      border-radius: 4px;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .file-item .name {
      color: #fff;
    }

    .file-item .remove {
      color: #ff6b6b;
      cursor: pointer;
      font-size: 16px;
    }

    .btn {
      width: 100%;
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 8px;
    }

    .btn-primary {
      background: #0d99ff;
      color: #fff;
    }

    .btn-primary:hover {
      background: #0b84e0;
    }

    .btn-primary:disabled {
      background: #555;
      color: #888;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #383838;
      color: #fff;
    }

    .btn-secondary:hover {
      background: #444;
    }

    .status {
      font-size: 11px;
      padding: 8px;
      border-radius: 4px;
      margin-top: 12px;
    }

    .status.success {
      background: rgba(93, 219, 147, 0.2);
      color: #5DDB93;
    }

    .status.error {
      background: rgba(216, 103, 92, 0.2);
      color: #D8675C;
    }

    .status.info {
      background: rgba(13, 153, 255, 0.2);
      color: #0d99ff;
    }

    .checkbox-group {
      margin-top: 12px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }

    .checkbox-item input {
      margin-right: 8px;
    }

    .checkbox-item label {
      font-size: 12px;
    }
  </style>
</head>

<body>
  <h2>ğŸ¨ Design Tokens â†’ Figma</h2>

  <div class="section">
    <div class="label">JSON íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</div>
    <div class="file-drop" id="fileDrop">
      <div class="file-drop-icon">ğŸ“</div>
      <div class="file-drop-text">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”<br>(colors.json, typography.json ë“±)</div>
      <input type="file" id="fileInput" accept=".json" multiple>
    </div>
    <div class="file-list" id="fileList"></div>
  </div>

  <div class="section">
    <div class="label">ìƒì„±í•  í•­ëª© ì„ íƒ</div>
    <div class="checkbox-group">
      <div class="checkbox-item">
        <input type="checkbox" id="chkVariables" checked>
        <label for="chkVariables">ğŸ¨ Variables (Colors, Spacing, Radius)</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="chkTextStyles" checked>
        <label for="chkTextStyles">ğŸ“ Text Styles (Typography)</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="chkComponents" checked>
        <label for="chkComponents">ğŸ§© Components (Button, Input, Card ë“±)</label>
      </div>
    </div>
  </div>

  <button class="btn btn-primary" id="btnCreate" disabled>ğŸ“¦ Figmaì— ìƒì„±í•˜ê¸°</button>

  <!-- Design System Export ì„¹ì…˜ -->
  <div class="section" style="margin-top: 24px; border-top: 1px solid #444; padding-top: 16px;">
    <h2>ğŸ“¤ Design System Export</h2>
    <div class="label">Variables, Styles, Componentsë¥¼ ì¶”ì¶œí•˜ì—¬ Style Guide ìƒì„±</div>

    <div class="checkbox-group" style="margin-top: 12px;">
      <div class="checkbox-item">
        <input type="checkbox" id="chkExportColors" checked>
        <label for="chkExportColors">ğŸ¨ Colors & Variables</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="chkExportTypo" checked>
        <label for="chkExportTypo">ğŸ“ Typography (Text Styles)</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="chkExportComps" checked>
        <label for="chkExportComps">ğŸ§© Components (ì„ íƒëœ í”„ë ˆì„)</label>
      </div>
      <div class="checkbox-item">
        <input type="checkbox" id="chkStyleGuide" checked>
        <label for="chkStyleGuide">ğŸ“š Style Guide í˜ì´ì§€ ìƒì„±</label>
      </div>
    </div>

    <button class="btn btn-primary" id="btnExportDS" style="margin-top: 12px;">ğŸ“¦ Design System ì¶”ì¶œ</button>

    <div id="downloadLinks" style="margin-top: 12px;"></div>
  </div>

  <!-- ê¸°ì¡´ HTML Export (ìˆ¨ê¹€) -->
  <details style="margin-top: 16px;">
    <summary style="cursor: pointer; font-size: 12px; color: #888;">ğŸ”§ ê°œë³„ HTML Export (ê³ ê¸‰)</summary>
    <div style="padding-top: 12px;">
      <button class="btn btn-secondary" id="btnScan">ğŸ” í”„ë ˆì„ ìŠ¤ìº”</button>
      <div id="componentList" class="file-list" style="margin-top: 12px; max-height: 100px; overflow-y: auto;"></div>
      <div class="checkbox-group" style="margin-top: 8px;">
        <div class="checkbox-item">
          <input type="checkbox" id="chkSeparateCSS" checked>
          <label for="chkSeparateCSS">ë³„ë„ CSS íŒŒì¼</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="chkPreviewPage" checked>
          <label for="chkPreviewPage">preview.html ìƒì„±</label>
        </div>
      </div>
      <button class="btn btn-secondary" id="btnExport" disabled style="margin-top: 8px;">ğŸ’¾ HTML Export</button>
    </div>
  </details>

  <button class="btn btn-secondary" id="btnClear">ğŸ—‘ï¸ ê¸°ì¡´ ìŠ¤íƒ€ì¼/ë³€ìˆ˜ ì‚­ì œ</button>
  <button class="btn btn-secondary" id="btnClose">ë‹«ê¸°</button>

  <div class="status info" id="status" style="display:none;"></div>

  <script>
    const fileDrop = document.getElementById('fileDrop');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const btnCreate = document.getElementById('btnCreate');
    const btnClose = document.getElementById('btnClose');
    const statusEl = document.getElementById('status');

    let loadedFiles = {};

    // íŒŒì¼ ë“œë¡­ ì´ë²¤íŠ¸
    fileDrop.addEventListener('click', () => fileInput.click());
    fileDrop.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileDrop.classList.add('dragover');
    });
    fileDrop.addEventListener('dragleave', () => {
      fileDrop.classList.remove('dragover');
    });
    fileDrop.addEventListener('drop', (e) => {
      e.preventDefault();
      fileDrop.classList.remove('dragover');
      handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

    function handleFiles(files) {
      Array.from(files).forEach(file => {
        if (file.name.endsWith('.json')) {
          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = JSON.parse(e.target.result);
              loadedFiles[file.name] = data;
              updateFileList();
              showStatus('success', `${file.name} ë¡œë“œ ì™„ë£Œ`);
            } catch (err) {
              showStatus('error', `${file.name} íŒŒì‹± ì‹¤íŒ¨: ${err.message}`);
            }
          };
          reader.readAsText(file);
        }
      });
    }

    function updateFileList() {
      const names = Object.keys(loadedFiles);
      if (names.length === 0) {
        fileList.innerHTML = '';
        btnCreate.disabled = true;
        return;
      }

      fileList.innerHTML = names.map(name => `
        <div class="file-item">
          <span class="name">âœ… ${name}</span>
          <span class="remove" data-name="${name}">Ã—</span>
        </div>
      `).join('');

      btnCreate.disabled = false;

      // ì‚­ì œ ë²„íŠ¼
      fileList.querySelectorAll('.remove').forEach(btn => {
        btn.addEventListener('click', () => {
          delete loadedFiles[btn.dataset.name];
          updateFileList();
        });
      });
    }

    function showStatus(type, message) {
      statusEl.className = `status ${type}`;
      statusEl.textContent = message;
      statusEl.style.display = 'block';
    }

    // ìƒì„± ë²„íŠ¼
    btnCreate.addEventListener('click', () => {
      const options = {
        createVariables: document.getElementById('chkVariables').checked,
        createTextStyles: document.getElementById('chkTextStyles').checked,
        createComponents: document.getElementById('chkComponents').checked,
        files: loadedFiles
      };

      showStatus('info', 'ìƒì„± ì¤‘...');
      parent.postMessage({ pluginMessage: { type: 'create', options } }, '*');
    });

    btnClose.addEventListener('click', () => {
      parent.postMessage({ pluginMessage: { type: 'close' } }, '*');
    });

    // ì‚­ì œ ë²„íŠ¼
    document.getElementById('btnClear').addEventListener('click', () => {
      showStatus('info', 'ì‚­ì œ ì¤‘...');
      parent.postMessage({ pluginMessage: { type: 'clear-all' } }, '*');
    });

    // ===== Export ê¸°ëŠ¥ =====
    const btnScan = document.getElementById('btnScan');
    const btnExport = document.getElementById('btnExport');
    const componentList = document.getElementById('componentList');
    const downloadLinks = document.getElementById('downloadLinks');
    let scannedComponents = [];

    // Design System Export ë²„íŠ¼
    document.getElementById('btnExportDS').addEventListener('click', () => {
      const options = {
        exportColors: document.getElementById('chkExportColors').checked,
        exportTypography: document.getElementById('chkExportTypo').checked,
        exportComponents: document.getElementById('chkExportComps').checked,
        generateStyleGuide: document.getElementById('chkStyleGuide').checked
      };

      showStatus('info', 'ğŸ“¦ Design System ì¶”ì¶œ ì¤‘...');
      parent.postMessage({ pluginMessage: { type: 'export-design-system', options } }, '*');
    });

    // ìŠ¤ìº” ë²„íŠ¼
    btnScan.addEventListener('click', () => {
      showStatus('info', 'ì„ íƒí•œ í”„ë ˆì„ ìŠ¤ìº” ì¤‘...');
      parent.postMessage({ pluginMessage: { type: 'scan-frames' } }, '*');
    });

    // ë‚´ë³´ë‚´ê¸° ë²„íŠ¼
    btnExport.addEventListener('click', () => {
      const selectedIds = [];
      componentList.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
        selectedIds.push(cb.dataset.id);
      });

      if (selectedIds.length === 0) {
        showStatus('error', 'ë‚´ë³´ë‚¼ ì»´í¬ë„ŒíŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”');
        return;
      }

      const options = {
        selectedIds,
        separateCSS: document.getElementById('chkSeparateCSS').checked,
        createPreview: document.getElementById('chkPreviewPage').checked
      };

      showStatus('info', 'HTML ìƒì„± ì¤‘...');
      parent.postMessage({ pluginMessage: { type: 'export-html', options } }, '*');
    });

    // í”ŒëŸ¬ê·¸ì¸ì—ì„œ ë©”ì‹œì§€ ë°›ê¸°
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (!msg) return;

      if (msg.type === 'status') {
        showStatus(msg.status, msg.message);
      }

      // ìŠ¤ìº” ê²°ê³¼ ìˆ˜ì‹ 
      if (msg.type === 'scan-result') {
        scannedComponents = msg.components || [];
        updateComponentList();
        showStatus('success', `${scannedComponents.length}ê°œ ì»´í¬ë„ŒíŠ¸ ë°œê²¬`);
      }

      // Export ëª¨ë“œë¡œ í¬ì»¤ìŠ¤
      if (msg.type === 'focus-export') {
        const exportSection = document.querySelector('#btnScan').parentElement;
        if (exportSection) {
          exportSection.scrollIntoView({ behavior: 'smooth' });
          showStatus('info', 'ğŸ“¤ í”„ë ˆì„ì„ ì„ íƒ í›„ ìŠ¤ìº”í•˜ì„¸ìš”');
        }
      }

      // Export ê²°ê³¼ ìˆ˜ì‹ 
      if (msg.type === 'export-result') {
        downloadLinks.innerHTML = '';
        const files = msg.files || [];

        if (files.length === 0) {
          showStatus('error', 'ìƒì„±ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
          return;
        }

        files.forEach(file => {
          const link = document.createElement('a');
          link.href = 'data:text/html;charset=utf-8,' + encodeURIComponent(file.content);
          link.download = file.name;
          link.className = 'file-item';
          link.style.display = 'block';
          link.style.marginBottom = '4px';
          link.style.textDecoration = 'none';
          link.innerHTML = `<span class="name">â¬‡ï¸ ${file.name}</span>`;
          downloadLinks.appendChild(link);
        });

        showStatus('success', `${files.length}ê°œ íŒŒì¼ ìƒì„± ì™„ë£Œ! ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.`);
      }
    };

    function updateComponentList() {
      if (scannedComponents.length === 0) {
        componentList.innerHTML = '<div style="color:#666;font-size:11px;">ìŠ¤ìº”ëœ ì»´í¬ë„ŒíŠ¸ ì—†ìŒ</div>';
        btnExport.disabled = true;
        return;
      }

      componentList.innerHTML = scannedComponents.map(comp => `
        <div class="file-item" style="padding: 6px 10px;">
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
            <input type="checkbox" data-id="${comp.id}" checked>
            <span class="name" style="font-size:11px;">${comp.name} (${comp.width}x${comp.height})</span>
          </label>
        </div>
      `).join('');

      btnExport.disabled = false;
    }
  </script>
</body>

</html>