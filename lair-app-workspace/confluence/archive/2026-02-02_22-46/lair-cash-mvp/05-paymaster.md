# 기능 정의서: 가스비 대납 (Paymaster)

> **원본**: [Confluence](https://bugcity.atlassian.net/wiki/spaces/BUGCITY/pages/420839447)  
> **버전**: 0.2

---

## 1. 기능 개요

사용자가 가스비 없이 스테이블코인을 전송할 수 있도록 Paymaster가 가스비를 대납합니다. 사용자는 크레딧을 소비하여 무료로 트랜잭션을 실행합니다.

---

## 2. Paymaster 서비스 비교

| 서비스 | Privy 연동 | 비용 (500 MAU 기준) | 비고 |
| --- | --- | --- | --- |
| **Privy (내장)** | ✅ 네이티브 | $1,250~$5,000 | 추가 SDK 불필요 |
| Pimlico | ✅ 가능 | $1,500~$6,000 | 별도 연동 |
| Biconomy | ✅ 가능 | $1,500~$5,500 | 별도 연동 |

### 추천: Privy 내장 Paymaster

| 장점 | 설명 |
| --- | --- |
| 연동 단순 | 이미 Privy 사용 중이므로 추가 SDK 불필요 |
| 비용 경쟁력 | 타 서비스 대비 동등 또는 저렴 |
| 단일 벤더 | 인증 + 지갑 + Paymaster 통합 관리 |

**예상 월 비용:** $2,000~$3,000 (500 MAU 기준)

---

## 3. 크레딧 시스템

### 3.1 크레딧 지급

| 항목 | 정책 |
| --- | --- |
| 신규 가입 시 | 5회 지급 |
| 리셋 주기 | 없음 (소진 후 끝) |
| 추가 획득 | 레퍼럴 보상 |
| 최대 보유 | 제한 없음 |

### 3.2 크레딧 사용

| 항목 | 정책 |
| --- | --- |
| 차감 시점 | **트랜잭션 요청 시** (성공/실패 무관) |
| 차감 단위 | 1회 |
| 0회일 때 | 전송 불가 → 바텀시트로 레퍼럴 유도 |

### 3.3 레퍼럴 보상

| 조건 | 보상 |
| --- | --- |
| 친구 1명 가입 | +3 크레딧 |
| 친구 첫 입금 | +2 크레딧 |

---

## 4. 비용 관리

### 4.1 예산 한도

| 항목 | 설정 |
| --- | --- |
| 월간 예산 | $5,000 |
| 모니터링 | 사용율 대시보드 |
| 알림 | 80% 도달 시 운영팀 알림 |

---

## 5. 화면 요소

### 5.1 홈 화면 크레딧 위젯

```
무료 전송: 3회  [+ 받기]
```

* 현재 크레딧 잔여 횟수
* [+ 받기] 버튼 → 레퍼럴 화면 이동

### 5.2 전송 확인 화면

```
가스비: 무료 (크레딧 1회 차감)
남은 크레딧: 3회 → 2회
```

### 5.3 크레딧 부족 바텀시트

```
┌─────────────────────────┐
│   무료 전송 크레딧 소진   │
│                         │
│  친구를 초대하면 크레딧을  │
│  더 받을 수 있어요!       │
│                         │
│  [친구 초대하기]          │
│       나중에             │
└─────────────────────────┘
```

---

## 6. 기술 연동

### 6.1 Privy Paymaster 설정

1. Privy Dashboard에서 Paymaster 활성화
2. Sponsorship Policy 설정:
   * 허용 체인: Ethereum
   * 허용 컨트랙트: USDC, USDT 컨트랙트 주소
   * 허용 메서드: `transfer`, `approve`
3. 예산 한도 설정

### 6.2 트랜잭션 플로우

```
1. 사용자 전송 요청
2. 크레딧 잔여 확인
3. 크레딧 차감 (요청 시점)
4. Privy Paymaster로 가스비 대납 트랜잭션 생성
5. 트랜잭션 서명 및 전송
6. 결과 반환
```

---

## 7. API

| API | 메서드 | 설명 |
| --- | --- | --- |
| /credit/balance | GET | 크레딧 잔액 조회 |
| /credit/use | POST | 크레딧 차감 |
| /credit/history | GET | 크레딧 사용 내역 |

---

## 8. QA 체크리스트

- [ ] 크레딧 보유 시 전송 성공
- [ ] 크레딧 차감 확인 (요청 시점)
- [ ] 크레딧 0일 때 바텀시트 노출
- [ ] 레퍼럴 화면 이동
- [ ] 트랜잭션 실패 시에도 크레딧 차감 확인
- [ ] 홈 화면 크레딧 위젯 표시
