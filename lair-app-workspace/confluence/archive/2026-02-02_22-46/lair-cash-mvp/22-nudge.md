# 친구 Nudge PRD

> **원본**: [Confluence](https://bugcity.atlassian.net/wiki/spaces/BUGCITY/pages/431226881)  
> **버전**: 1.1

---

## 1. 개요

### 목적

* 이탈한 친구를 "콕 찔러서" 서비스로 복귀시킴
* 친구 관계를 활용한 자연스러운 리텐션 메커니즘
* Nudge 발송자에게도 XP 보상 제공

### 핵심 가설

> 친구가 "콕 찔렀어!" 알림을 받으면 사회적 압력으로 서비스에 복귀할 가능성이 높다.

---

## 2. XP 보상 구조

| 행동 | XP | 조건 |
| --- | --- | --- |
| Nudge 발송 | +1 XP | 발송 즉시 지급 |
| Nudge 성공 | +3 XP | 친구가 24시간 내 금캐기 시작 시 |

---

## 3. Nudge 가능 조건

### 3.1 친구 상태

| 상태 | 의미 | Nudge 가능 |
| --- | --- | --- |
| mining | 채굴 중 | ❌ |
| harvestable | 수확 가능 (안 함) | ✅ |
| idle | 대기 중 (오래 안 함) | ✅ |

### 3.2 쿨다운

| 조건 | 값 |
| --- | --- |
| 동일 친구 | 24시간에 1회만 |
| 본인 총 발송 | 제한 없음 (어뷰징 모니터링) |

---

## 4. 푸시 알림

### 4.1 Nudge 수신자

| 항목 | 내용 |
| --- | --- |
| 제목 | "{닉네임}님이 콕 찔렀어요! 👆" |
| 본문 | "금캐기를 시작해서 친구에게 보상을 선물하세요" |
| 딥링크 | 홈 화면 (금캐기 버튼 강조) |

### 4.2 Nudge 성공 발송자

| 항목 | 내용 |
| --- | --- |
| 제목 | "✨ +3 XP 획득!" |
| 본문 | "{친구 닉네임}님이 금캐기를 시작했어요" |

---

## 5. 화면 구성

### 5.1 친구 목록 (Nudge 버튼)

```
[내 친구들]              👥 3명
┌────────────────────────────────┐
│ 김** (내가 초대)     [콕 찌르기] │
├────────────────────────────────┤
│ 이** (나를 초대)       채굴 중   │
├────────────────────────────────┤
│ 박** (내가 초대)     [콕 찌르기] │
└────────────────────────────────┘
```

### 5.2 Nudge 버튼 상태

| 상태 | 표시 |
| --- | --- |
| 가능 | [콕 찌르기] 활성화 |
| 채굴 중 | "채굴 중" 텍스트 |
| 24시간 내 발송 | "발송완료 ✓" 비활성화 |

### 5.3 Nudge 발송 확인 팝업

```
┌─────────────────────────┐
│   콕 찌르기 완료! 👆     │
│                         │
│  +1 XP를 획득했어요      │
│                         │
│  친구가 금캐기를 시작하면 │
│  +3 XP를 더 받아요!      │
│                         │
│       [ 확인 ]          │
└─────────────────────────┘
```

---

## 6. API

| 메서드 | 엔드포인트 | 설명 |
| --- | --- | --- |
| GET | /friends | 친구 목록 + 상태 |
| POST | /friends/{id}/nudge | Nudge 발송 |

### 6.1 GET /friends Response

```json
{
  "friends": [
    {
      "id": "friend_123",
      "nickname": "김**",
      "relation": "invited",
      "status": "harvestable",
      "canNudge": true,
      "lastNudgedAt": null
    },
    {
      "id": "friend_456",
      "nickname": "이**",
      "relation": "invited_by",
      "status": "mining",
      "canNudge": false,
      "lastNudgedAt": null
    }
  ],
  "totalCount": 2
}
```

### 6.2 POST /friends/{id}/nudge Response

```json
{
  "success": true,
  "xpEarned": 1,
  "message": "콕 찌르기를 보냈어요!"
}
```

### 6.3 에러 응답

| 코드 | 상황 | 메시지 |
| --- | --- | --- |
| NUDGE_001 | 24시간 내 이미 발송 | "24시간 후에 다시 찌를 수 있어요" |
| NUDGE_002 | 채굴 중인 친구 | "친구가 이미 채굴 중이에요" |

---

## 7. 성공 지표 (KPI)

| 지표 | 목표 | 측정 방법 |
| --- | --- | --- |
| Nudge 발송률 | 30%+ | 친구가 있는 유저 중 Nudge 발송 |
| Nudge 성공률 | 30%+ | Nudge 발송 → 24시간 내 금캐기 |
| 복귀 리텐션 | 50%+ | Nudge 복귀 유저 중 7일 후 재방문 |

---

## 8. QA 체크리스트

### 8.1 친구 목록
- [ ] 친구 목록 로드
- [ ] 닉네임 마스킹 (김**)
- [ ] 관계 표시 (내가 초대 / 나를 초대)
- [ ] 상태 표시 (채굴 중 / 수확 가능 / 대기 중)

### 8.2 Nudge 발송
- [ ] Nudge 버튼 클릭 시 발송
- [ ] +1 XP 획득 확인
- [ ] 발송 확인 팝업 표시
- [ ] 버튼 "발송완료 ✓"로 변경

### 8.3 쿨다운
- [ ] 24시간 내 동일 친구 Nudge 불가
- [ ] 24시간 후 다시 가능

### 8.4 푸시 알림
- [ ] 수신자 푸시 수신
- [ ] 푸시 탭 시 앱 이동
- [ ] Nudge 성공 시 발송자 푸시
