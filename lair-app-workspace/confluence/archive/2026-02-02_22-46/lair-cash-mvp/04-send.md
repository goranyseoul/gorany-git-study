# 기능 정의서: 전송 (Send)

> **원본**: [Confluence](https://bugcity.atlassian.net/wiki/spaces/BUGCITY/pages/420839425)  
> **버전**: 0.3

---

## 1. 기능 개요

사용자가 스테이블코인을 외부 지갑으로 전송하는 기능입니다. 가스비는 크레딧으로 대납되며, 생체 인증 후 전송됩니다.

---

## 2. 핵심 플로우

```
홈 → "보내기" → 금액 입력 → 주소 입력 → 확인 → 생체 인증 → Paymaster 가스 대납 → 전송 → 결과
```

---

## 3. 상세 스펙

### 3.1 토큰 및 네트워크

| 항목 | 스펙 |
| --- | --- |
| 지원 토큰 | USDC 또는 USDT (1개만, TBD) |
| 네트워크 | Ethereum (고정) |
| 토큰 선택 UI | 없음 (단일 토큰이므로 자동 선택) |

### 3.2 금액 입력

| 항목 | 스펙 |
| --- | --- |
| 최소 금액 | 0.01 |
| 최대 금액 | 보유 잔액 |
| 소수점 | 최대 6자리 |
| MAX 버튼 | 잔액 전체 입력 |
| USD 환산 | 실시간 표시 |

### 3.3 주소 입력

| 항목 | 스펙 |
| --- | --- |
| 형식 | Ethereum (0x + 40자리 hex) |
| 검증 | EIP-55 체크섬 |
| 본인 주소 | 차단 (자기 송금 불가) |
| 입력 방식 | 직접 입력, 붙여넣기, QR 스캔 |

### 3.4 가스비 대납 (Paymaster)

| 항목 | 스펙 |
| --- | --- |
| 비용 | 무료 (크레딧 차감) |
| 차감 시점 | 트랜잭션 요청 시 (성공/실패 무관) |
| 차감 단위 | 1회 |

---

## 4. ERC-20 트랜잭션 처리

### 4.1 approve + transfer

| 상황 | 처리 |
| --- | --- |
| 신규 전송 | approve(max) + transfer 동시 실행 |
| 기존 승인 있음 | transfer만 실행 |
| 크레딧 차감 | 1회만 차감 (2tx 묶음 처리) |

### 4.2 UX 처리

| 항목 | 스펙 |
| --- | --- |
| 로딩 화면 | 1개만 표시 (내부적으로 2tx) |
| 에러 시 | 전체 실패 처리, 재시도 |

---

## 5. 화면 구성

### 5.1 금액 입력 화면

| 영역 | 요소 |
| --- | --- |
| 타이틀 | "보내기" |
| 잔액 표시 | "보유: $XX.XX" |
| 입력 필드 | 숫자 입력 + MAX 버튼 |
| 다음 버튼 | 금액 유효 시 활성화 |

### 5.2 주소 입력 화면

| 영역 | 요소 |
| --- | --- |
| 입력 필드 | 주소 입력 |
| 붙여넣기 | 버튼 |
| QR 스캔 | 버튼 |
| 다음 버튼 | 주소 유효 시 활성화 |

### 5.3 확인 화면

| 영역 | 요소 |
| --- | --- |
| 전송 금액 | $XX.XX |
| 받는 주소 | 0x...XXXX (축약) |
| 가스비 | "무료 (크레딧 1회 차감)" |
| 남은 크레딧 | "3회 → 2회" |
| 전송 버튼 | Primary CTA |

---

## 6. API

| API | 메서드 | 설명 |
| --- | --- | --- |
| /wallet/send | POST | 전송 요청 |
| /wallet/balance | GET | 잔액 조회 |
| /credit/balance | GET | 크레딧 잔액 |
| /credit/use | POST | 크레딧 차감 |

---

## 7. 에러 처리

| 상황 | 처리 |
| --- | --- |
| 잔액 부족 | "잔액이 부족합니다" + MAX 금액 안내 |
| 유효하지 않은 주소 | "유효한 Ethereum 주소를 입력해주세요" |
| 본인 주소 입력 | "본인 주소로는 전송할 수 없습니다" |
| 크레딧 부족 | 바텀시트 → 레퍼럴 화면 유도 |
| 생체 인증 실패 | "인증에 실패했습니다. 다시 시도해주세요" |
| 트랜잭션 실패 | "전송에 실패했습니다" + 재시도 |

---

## 8. QA 체크리스트

### 8.1 금액 입력
- [ ] 금액 정상 입력
- [ ] 소수점 6자리까지 입력
- [ ] MAX 버튼 동작
- [ ] 잔액 초과 시 에러

### 8.2 주소 입력
- [ ] 주소 직접 입력
- [ ] 붙여넣기 동작
- [ ] QR 스캔 동작
- [ ] 유효하지 않은 주소 에러
- [ ] 본인 주소 차단

### 8.3 트랜잭션
- [ ] 생체 인증 성공 후 전송
- [ ] 크레딧 차감 확인
- [ ] 전송 성공 화면
- [ ] 전송 실패 화면 + 재시도
