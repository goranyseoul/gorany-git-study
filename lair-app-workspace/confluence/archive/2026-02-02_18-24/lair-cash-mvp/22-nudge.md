# 기능 정의서: 친구 Nudge

> **원본**: [Confluence](https://bugcity.atlassian.net/wiki/spaces/BUGCITY/pages/431226881)  
> **최종 수정**: 2026-02-02  
> **버전**: 1.1

---

## 1. 개요

### 목적

- 이탈 유저를 친구가 다시 앱으로 데려오는 리텐션 기능
- 친구 초대의 가치를 높여 바이럴 강화
- 소셜 요소로 앱 참여도 증가

### 핵심 컨셉

> **"친구가 금캐기를 안 하고 있으면 콕 찔러서 알려주자!"**

- 레퍼럴로 연결된 계정들은 **친구** 관계
- 친구가 금캐기를 할 수 있는데 안 하고 있으면 **Nudge** 가능
- Nudge 보내면 **XP 획득**

---

## 2. 친구 관계 정의

### 2.1 친구 범위

| 관계 | 친구 여부 |
| --- | --- |
| 내가 초대한 사람 | ✅ 친구 |
| 나를 초대한 사람 | ✅ 친구 |
| 친구의 친구 | ❌ 친구 아님 |

### 2.2 예시

```
A가 B를 초대 → A와 B는 서로 친구
B가 C를 초대 → B와 C는 서로 친구
             → A와 C는 친구 아님
```

### 2.3 친구 목록 데이터

| 필드 | 설명 |
| --- | --- |
| friend_id | 친구 계정 ID |
| nickname | 친구 닉네임 (마스킹) |
| relationship | "invited" / "invited_by" |
| joined_at | 친구 가입 일시 |
| game_status | 현재 게임 상태 |
| last_nudge_at | 마지막 Nudge 발송 시간 |

---

## 3. Nudge 조건

### 3.1 Nudge 가능 상태

| 친구 상태 | Nudge 가능 | 설명 |
| --- | --- | --- |
| harvestable | ✅ | 수확 가능한데 안 하고 있음 |
| idle | ✅ | 금캐기 안 하고 있음 |
| mining | ❌ | 이미 채굴 중 |

### 3.2 쿨다운

- 동일 친구에게 24시간에 1회만 Nudge 가능
- 다른 친구에게는 제한 없음

---

## 4. XP 획득

| 조건 | XP | 비고 |
| --- | --- | --- |
| Nudge 발송 | +1 XP | 발송 즉시 지급 |
| Nudge 성공 | +3 XP | 친구가 24시간 내 금캐기 시작 시 |

---

## 5. UI 화면

### 5.1 친구 초대 화면 내 친구 목록

```
├─────────────────────────────────────┤
│  [내 친구들]              👥 3명     │
│                                     │
│  김** (내가 초대)          [콕 찌르기] │
│  └ 수확 가능 ⏰                      │
│                                     │
│  이** (나를 초대)          채굴 중 ⛏️ │
│                                     │
│  박** (내가 초대)          [콕 찌르기] │
│  └ 대기 중                          │
├─────────────────────────────────────┤
```

### 5.2 Nudge 발송 후 피드백

- 버튼 → "발송 완료 ✓" (24시간 비활성화)
- 토스트: "친구에게 금캐기 알림을 보냈어요! (+1 XP)"

### 5.3 Nudge 성공 시 알림

- 푸시: "친구가 금캐기를 시작했어요! +3 XP"
- 인앱 배너: 배틀패스 XP 표시 업데이트

---

## 6. 푸시 알림 (수신자)

| 상황 | 제목 | 내용 |
| --- | --- | --- |
| Nudge 수신 | 친구가 콕 찔렀어요! 👆 | 김** 님이 금캐기 하라고 찔렀어요. 지금 시작하면 보상 획득! |

---

## 7. API

| API | 메서드 | 설명 |
| --- | --- | --- |
| /friends | GET | 친구 목록 + 상태 조회 |
| /friends/{id}/nudge | POST | Nudge 발송 |
| /nudges/pending | GET | 미확인 Nudge 조회 |
| /nudges/{id}/read | POST | Nudge 확인 처리 |

---

## 8. Response 예시

### GET /friends

```json
{
  "friends": [
    {
      "id": "uuid",
      "nickname": "김**",
      "relationship": "invited",
      "game_status": "harvestable",
      "can_nudge": true,
      "last_nudge_at": null
    },
    {
      "id": "uuid",
      "nickname": "이**",
      "relationship": "invited_by",
      "game_status": "mining",
      "can_nudge": false,
      "last_nudge_at": "2026-02-01T10:00:00Z"
    }
  ]
}
```

### POST /friends/{id}/nudge

```json
{
  "success": true,
  "xp_earned": 1,
  "next_nudge_available_at": "2026-02-03T10:00:00Z"
}
```

---

## 9. QA 체크리스트

### 9.1 친구 목록

- [ ] 친구 목록 정상 로드
- [ ] 친구 상태 (채굴 중/수확 가능/대기 중) 정확히 표시
- [ ] 닉네임 마스킹 적용 (김**)

### 9.2 Nudge 발송

- [ ] Nudge 가능 상태에서 버튼 활성화
- [ ] Nudge 발송 후 버튼 비활성화
- [ ] 24시간 후 버튼 재활성화
- [ ] XP +1 즉시 지급 확인

### 9.3 Nudge 성공

- [ ] 친구가 금캐기 시작 시 XP +3 지급
- [ ] 24시간 초과 시 성공 XP 미지급
- [ ] 푸시 알림 수신 확인

### 9.4 수신자 경험

- [ ] 푸시 알림 수신
- [ ] 앱 진입 시 Nudge 배너 표시
- [ ] 배너 클릭 → 금캐기 게임 이동

---

## 10. 프라이버시 고려사항

| 정보 | 노출 여부 | 비고 |
| --- | --- | --- |
| 친구 닉네임 | 마스킹 (김**) | 전체 이름 미노출 |
| 게임 상태 | ✅ | 핵심 기능 |
| 정확한 시간 | ❌ | "쿨타임 완료"만 표시 |
| 보유 금/달러 | ❌ | 미노출 |
